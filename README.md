# GuanDan
##### 本项目由Si-xiyu完成，系华南理工大学24级C++实训作业，仅供学习交流，请勿用于学术造假或商业用途。
##### This project was completed by Si-xiyu as a C++ training assignment for the Class of 2024 at South China University of Technology(SCUT). It is for academic exchange only and should not be used for academic fraud or commercial purposes. 
欢迎报考华南理工大学OwO（）
# 规则介绍

1.  单牌：牌的大小顺序为：大王、小王、级牌、A、K、…、2.

2.  对子：大小顺序与单牌相同，最大的对子为对大王。

3.  三张牌可以是三不带，也可以是三带一对，但不可以三带一。

4.  四张及以上是炸弹，张数多则炸弹大。

5.  钢板：连续的两组三张牌。例如555666.与斗地主不同，2 可以出现在钢板中，如AAA222和222333.最大的钢板为KKKAAA.

6.  顺子：连续的**五张**单牌。与斗地主不同，2可以出现在顺子中，如A2345和23456.最大顺子为10JQKA.花色相同的顺子为**同花顺**，5炸<同花顺<6炸.

7.  连对：连续的**三个**对子。与斗地主不同，2可以出现在连对中，如AA2233和223344.最大连对为QQKKAA.

8.  癞子规则：**红桃**级牌为癞子，可以替代除大小王以外的任何牌。

9.  升级规则：一二位升三级，一三位升两级，一四位升一级。最后一个出完牌的玩家向第一个出完牌的玩家进贡；进贡的牌为自己手上最大的牌，吃贡的玩家还一张10以下的牌给进贡者。若两张大王同在输家手中，或输家手中没有大过A的牌则不用进贡。

### 进贡与出牌

1. **单下情况**：如果上一局游戏的最后一名（下游）玩家所在的团队没有包揽最后两名，则由下游玩家向上游玩家进贡一张自己手中最大的牌。
    
2. **双下情况**：如果上一局游戏的最后两名（三游和下游）玩家属于同一团队（即双下），则双下方的两名玩家都需要向上游方的两名玩家分别进贡一张最大的牌。
    
3. **抗贡条件**：如果下游玩家手中有两张大王，则可以抗贡，即无需进贡。在双下情况下，如果双下方的两名玩家各自有一张大王，或者其中一人有两张大王，也可以抗贡。
    

### 进贡的牌选择

- 进贡的牌必须是进贡玩家手中最大的单张牌，但红桃级牌（逢人配）除外。
    
- 如果进贡玩家手中没有大王，则进贡最大的单张牌。
    

### 还贡规则

- 接受进贡的玩家需要从自己的手牌中选择一张牌还给进贡者。
    
- 还给己方搭档的牌必须是10以下（含10）的牌。
    
- 还给对方的牌可以是任意牌。
    

### 出牌顺序

- 在单下情况下，进贡者先出牌。
    
- 在双下情况下，进贡大者先出牌，若进贡牌点相同，则按顺时针方向确定出牌顺序。
    
- 如果出现抗贡，则由上游玩家先出牌。
    

这些规则从第二局开始生效，第一局游戏结束后根据玩家的名次确定是否需要进贡
# 功能介绍
本项目实现了以下任务    
**任务一**

1.  简易图形界面、规则介绍；

2.  随机发牌、确定头家、确定首出玩家；

3.  正确判断牌型、出牌是否符合规则；

4.  简易人机对战（AI有牌就出，默认出最小牌）。

**任务二**

1.  记牌器（需要显示外面的牌还剩几张，以及玩家曾经出过什么牌）；

2.  倍数（分数）计算：每出一个炸弹或同花顺则分数乘以2；

3.  游戏排行榜：正确排出四个玩家的排名

**任务三**

1.  各种参数设置与保存（出牌时间限制、声音大小、开启或关闭声音等）；

2.  出牌提示（提示如何出牌可以大过上一个出牌者）、要不起（即提示玩家没有大过上一个出牌者的牌）等更精巧的交互界面。

3.  更精美的图形界面、声音效果。


# 软件架构
本项目采用MVC架构，通过GD_Controller类控制游戏主流程。  
**Module**包括Card，Team，Player等用于数据类，以及CardCombo等方法类。
**View**包括CardWidget，PlayerAreaWidget，LeftWidget，GuanDan等类，用于负责视图逻辑。

# 开发环境
本项目基于Qt 5.12.5和MSVC环境，由VS2022 + Qt Tool插件开发

# 亮点
采用启发式算法来负责AI出牌逻辑，避免穷举导致的内存过度占用    
MVC架构，各个模块耦合度低，易于实现功能拓展

# 现存问题
手牌展示的视图逻辑有问题，LeftWidget的视图布局不够合理，HMPlayer中的相关逻辑没有实现（该部分可以实现多名玩家联机对战），没有在主流程中加入数据库接口。
